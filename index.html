<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Wix openapi-node Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Wix openapi-node</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="API.html">Wix/API</a>
						</li>
						
						<li>
							<a href="connect.html">wix/connect</a>
						</li>
						
						<li>
							<a href="Connect_.html">Wix/Connect</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Activities.html">Activities</a>
						</li>
						
						<li>
							<a href="ActivityType.html">ActivityType</a>
						</li>
						
						<li>
							<a href="APIBuilder.html">APIBuilder</a>
						</li>
						
						<li>
							<a href="BaseWixAPIObject.html">BaseWixAPIObject</a>
						</li>
						
						<li>
							<a href="Contact.html">Contact</a>
						</li>
						
						<li>
							<a href="Contacts.html">Contacts</a>
						</li>
						
						<li>
							<a href="Insights.html">Insights</a>
						</li>
						
						<li>
							<a href="Wix.html">Wix</a>
						</li>
						
						<li>
							<a href="WixActivity.html">WixActivity</a>
						</li>
						
						<li>
							<a href="WixActivityData.html">WixActivityData</a>
						</li>
						
						<li>
							<a href="WixAPICaller.html">WixAPICaller</a>
						</li>
						
						<li>
							<a href="WixPagingData.html">WixPagingData</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
		<div class="span8">
			
				<div id="main">
					


	
	<span class="page-title">Index</span>
	
	












	
	





    <section>
        <article><h1>openapi-node</h1>
<h1>Node library to work with the the Wix RESTful API.</h1>
<p>Read about <a href="http://dev.wix.com/docs/display/DRAF/Third+Party+Apps+-+Introduction">developing a third party app for the Wix platform</a>.</p>
<h2>Prerequisites</h2>
<ul>
<li><strong>Register your app</strong> <a href="http://dev.wix.com/docs/display/DRAF/Dev+Center+Registration+Guide">here</a> to <strong>obtain</strong> your <strong>APP_KEY</strong> and <strong>APP_SECRET</strong></li>
<li><strong>Get the Javascript SDK</strong> <a href="http://dev.wix.com/docs/display/DRAF/JavaScript+SDK">here</a>. You'll need it for any data altering API calls (such as creating an activity).</li>
</ul>
<h2>Installation</h2>
<pre><code>$ npm install openapi-node</code></pre>
<h2>API Documentation</h2>
<p><a href="http://wix.github.io/openapi-node/">Read the docs</a> and take a look at our Mocha tests to learn more ways to use the library.</p>
<h2>Quick Start</h2>
<pre><code class="lang-js">var express = require('express');
var app = express();
var openapi = require('openapi-node');

var APP_SECRET = 'YOUR_APP_SECRET';
var APP_ID = 'YOUR_APP_ID';

// The route should match the app endpoint set during registration
app.get('/', function (req, res) {

    // The GET request to your app endpoint will contain an instance parameter for you to parse
    var instance = req.query.instance;
    var message = 'Instance Not Verified';

    try {
        // Parse the instance parameter
        var wixInstance = wix.getConnect().parseInstance(instance, APP_SECRET);
        var instanceId = wixInstance.instanceId;

        // Get a shortcut for the Wix RESTful API
        wixAPI = wix.getAPI(APP_SECRET, APP_ID, instanceId);

        console.log(&quot;Once you've reached this point you're good to use the Wix API, otherwise an exception will be thrown.&quot;);

        message = 'Instance verified';
        res.send( message );

    } catch(e) {
        message = &quot;Wix API init failed. Check your app key, secret and instance Id&lt;br&gt;&quot; + e.message;
        console.log( message );
        res.send( message );
    }

});

app.listen(3000);</code></pre>
<h2>Examples</h2>
<h3>Working with the Contact Object</h3>
<h4>Get a list of Contacts from The Wix Hive</h4>
<pre><code class="lang-js">api.Contacts.getContacts().then(
    function(wixCursor) {

        // Do something with the Contacts
    },
    function(error) {
        throw error;
    }
);</code></pre>
<h4>Create a Contact a post it to the Wix Hive</h4>
<p>The newContact function returns a Contact object. The Contact created is only known locally, it has not been saved to the Wix Hive and does not have an ID.
To share your Contact with the Wix Hive, use the create function as shown below.</p>
<pre><code class="lang-js">var contact = api.Contacts.newContact(api); // Created a new Contact object. This Contact is only known locally, at this point it has not been saved to the Wix Hive.
contact.name({first: 'Karen', last: 'Meep'});
contact.company({role: 'MyRole', name: 'MyName'});
contact.picture('http://elcaminodeamanda.files.wordpress.com/2011/03/mc_hammer.png');
contact.addPhone({ tag: 'work', phone: '+1-415-639-5555'});
contact.addAddress(
    {
        tag: 'work',
        address: '500 Terry A Francois',
        city: 'San Francisco',
        region: 'CA',
        country: 'USA',
        postalCode: 94158
    });
contact.addDate({ tag: 'work', date: '1994-11-05T13:15:30Z'});
contact.addUrl({ tag: 'work', url: 'http://www.wix.com/'});
api.Contacts.create(contact).then(
    function (contact) {

        // The Contact now exists in the Wix Hive. It has an ID which can be used to query it.
    },
    function (error) {
        throw error;
    }
);</code></pre>
<h4>Update Contact properties</h4>
<p>Use this method update many Contact properties at once.</p>
<pre><code class="lang-js">
var contact = api.Contacts.newContact(api);
api.Contacts.create(contact).then(
    function (contact) {

        contact.name().prefix('Sir');
        contact.name().first('Mix');
        contact.name().middle('A');
        contact.name().last('Lot');
        contact.name().suffix('The III');
        contact.company({role: 'MyRole', name: 'MyName'});
        contact.picture('http://assets.objectiface.com/hashed_silo_content/silo_content/6506/resized/mchammer.jpg');
        contact.addPhone({ tag: 'work', phone: '+1-415-639-5555'});
        contact.addEmail({tag: 'work', email: 'karenc@wix.com'});
        contact.addAddress(
            {
                tag: 'work',
                address: '500 Terry A Francois',
                city: 'San Francisco',
                region: 'CA',
                country: 'USA',
                postalCode: 94158
            });
        contact.addDate({ tag: 'work', date: '1994-11-05T13:15:30Z'});
        contact.addUrl({ tag: 'work', url: 'http://www.wix.com/'});

        contact.update().then(
            function(contact){

                // Do more stuff with the returned updated contact
            },
            function(error){
                throw error;
            }
        );
    },
    function (error) {
        throw error;
    }
);</code></pre>
<h4>Explicit property update methods</h4>
<p>To explicitly and immediately update Contact properties use the Contact.update<propertyName> methods. These methods make an HTTP PUT call to one of the /contacts/{contactId}/<propertyName> endpoints.
We recommend using the Contact.update method if you need to change more than one property at a time.</p>
<p>The example below shows how to update the name property of a Contact.</p>
<pre><code class="lang-js">var contact = api.Contacts.newContact();
contact.name({first: 'Karen', last: 'Meep'});
api.Contacts.create(contact).then(
    function (contact) {
        contact.name().prefix('Sir');
        contact.name().first('Mix');
        contact.name().middle('A');
        contact.name().last('Lot');
        contact.name().suffix('The III');

        contact.updateName().then(
            function (contact) {

                // ...
            },
            function (error) {
                throw error;
            }
        );
    },
    function (error) {
        throw error;
    }
);</code></pre>
<h4>Post an activity against a Contact</h4>
<p>The code below posts an Activity against the given Contact.</p>
<p>Note: Use the Activities.postActivity function to post an Activity in no relation to a Contact.</p>
<pre><code class="lang-js">var activity = api.Activities.newActivity(api.Activities.TYPES.ALBUM_FAN);
activity.activityLocationUrl = &quot;http://www.wix.com&quot;;
activity.activityDetails.summary = &quot;test&quot;;
activity.activityDetails.additionalInfoUrl = &quot;http://www.wix.com&quot;;
activity.activityInfo.album.name = &quot;Wix&quot;;
activity.activityInfo.album.id = &quot;1234&quot;;
var contact = api.Contacts.newContact();
contact.name({first: 'Karen', last: 'Meep'});
api.Contacts.create(contact).then(
    function(contact){

        contact.addActivity(activity, api).then(
            function(data){

                var activityId = data.activityId;
                var contactId = data.contactId;

                // Do something with this information
            },
            function(error){
                throw error;
            }
        );
    },
    function(error){
        throw error;
    }
);</code></pre>
<h4>Get Contact Activities</h4>
<p>The code below posts an Activity against the given Contact.</p>
<p>Note: Use the Activities.postActivity function to post an Activity in no relation to a Contact.</p>
<pre><code class="lang-js">contact.getActivities(nextCursor,
    {
        from: date1.toISOString(),
        until: date2.toISOString(),
        activityTypes: [api.Activities.TYPES.ALBUM_FAN.name, api.Activities.TYPES.ALBUM_SHARE.name],
        scope: 'app'
    }
).then(
    function(pagingActivitiesResult){
        var activities = pagingActivitiesResult.results;
        array.forEach(function(activity) {
            // Do something with the activity
        });

        if (pagingActivitiesResult.nextCursor !== 0) {

            // Get more activities using the cursor
            contact.getActivities(pagingActivitiesResult.nextCursor).then(...)
        }
    },
    function(error){
        throw error;
    }
);</code></pre>
<h3>Get an existing Contact from The Wix Hive</h3>
<pre><code class="lang-js">api.Contacts.getContactById('SOME_CONTACT_ID).then(
    function(contact){

        // Do stuff with this Contact
    },
    function(error){
        throw(error);
    }
);</code></pre>
<h3>Get a list of site Contact Subscribers</h3>
<p>Subscribers are Contacts for the given site that have opted in to receiving communications from applications.</p>
<pre><code class="lang-js">api.Contacts.getContactsSubscribers(
    {
        status: notSet, // or optIn
        pageSize: 50
    }
).then(
    function(pagingContactsResult) {

        // Contact the site's subscribers
    },
    function(error) {
        throw error;
    }
);</code></pre>
<h3>Post an activity</h3>
<p>This is where the <a href="http://dev.wix.com/docs/display/DRAF/JavaScript+SDK">Javascript SDK</a> comes in to play. Use it to obtain a user session token, then use the token to create an activity on behalf of the user.</p>
<p>Here's an example of how to obtain the session token and then sending it to the NodeJS server</p>
<pre><code class="lang-js">$(&quot;#createActivityButton&quot;).click(function() {
    Wix.Activities.getUserSessionToken(
        function onSuccess(token){
            console.log('got token: ' + token);
            $.get('/createActivity', {token: token}, function(result) {
                alert(result);
            });
        }
    );
});</code></pre>
<p>Use the session token on your Node server to create an activity an post it to the Wix Hive.
Note: This code posts an Activity without any connection to a Contact. To post an Activity against a Contact use the Contact.addActivity method.</p>
<pre><code class="lang-js">var activity = api.Activities.newActivity(api.Activities.TYPES.CONTACT_FORM);
activity.activityLocationUrl = &quot;http://www.wix.com&quot;;
activity.activityDetails.summary = &quot;test&quot;;
activity.activityDetails.additionalInfoUrl = &quot;http://www.wix.com&quot;;

var cu = activity.contactUpdate;
cu.addEmail(cu.newEmail().withTag(&quot;main&quot;).withEmail(&quot;name@wexample.com&quot;));

cu.name.withFirst(&quot;Your&quot;).withLast(&quot;Customer&quot;);

activity.withLocationUrl(&quot;test.com&quot;).withActivityDetails(&quot;This is a test activity post&quot;, &quot;http://www.test.com&quot;);
var ai = activity.activityInfo;
ai.addField(ai.newField().withName(&quot;email&quot;).withValue(&quot;name@wexample.com&quot;));
ai.addField(ai.newField().withName(&quot;first&quot;).withValue(&quot;Your&quot;));
ai.addField(ai.newField().withName(&quot;first&quot;).withValue(&quot;Your&quot;));
ai.addField(ai.newField().withName(&quot;last&quot;).withValue(&quot;Customer&quot;));

api.Activities.postActivity(activity, SESSION_ID)
    .then(function(data) {
        data.should.not.equal(undefined);
        data.should.be.a.String;
        data.should.not.be.empty;
        data.should.not.be.length(0)
        done();
    }, function(error) {
        throw error;
    });</code></pre>
<h2>Questions?</h2>
<p>Explore the complete <a href="http://dev.wix.com/docs/display/DRAF/Working+with+the+Wix+RESTful+API">documentation</a></p></article>
    </section>







				</div>

				<div class="clearfix"></div>
				<footer>
					
					<a href='http://dev.wix.com'>Wix Developer Center</a>
					<br />
					
					
		<span class="copyright">
		2014, Wix
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Thu Jul 31 2014 16:30:00 GMT+0300 (IDT) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<div class="span3">
				<div id="toc"></div>
			</div>
			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:false,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>